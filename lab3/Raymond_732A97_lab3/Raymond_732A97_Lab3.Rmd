---
title: "Lab 3 732A97"
author: "Raymond Sseguya"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=TRUE, warning=FALSE, message=FALSE)
```

# Data
```{r}
library(dplyr)

trackrcs <- read.table("T1-9.dat",
  col.names = c("countries", "x100m", "x200m", 
        "x400m", "x800m", "x1500m", "x3000m", "marathon"))
rownames(trackrcs) <- trackrcs[,1]

```


# Question 1: Principal components, including interpretation of them

## a) Obtain the sample correlation matrix R for these data, and determine its eigenvalues and eigenvectors.
```{r}
S <- cov(trackrcs[,-1])
R <- cov2cor(S); R

eigen(R)$values
eigen(R)$vectors

```


## b) Determine the first two principal components for the standardized variables. Prepare a table showing the correlations of the standardized variables with the components, and the cumulative percentage of the total (standardized) sample variance explained by the two components.

### the first two principal components for the standardized variables
```{r}
res=prcomp((trackrcs)[,-1], scale. = FALSE)
# No sacling at this point because we are going to use the correlation matrix later

# Each PC is a linear combination of the original variables
#### res$rotation
res$rotation[,1:2]
```


\pagebreak

### correlation of the standardized variables with the components
This is following the formula in the text book on page 433, "Result 8.3" and "Equation 8-8"
```{r}
eigenvalues=res$sdev^2
CorWithPC <-
  t(res$rotation[,1:2])%*%sqrt(diag(eigenvalues))%*%solve(sqrt(diag(diag(R))))
colnames(CorWithPC) <- colnames(trackrcs[,-1])
t(CorWithPC)
```


### cummulative percentage of total standardized sample variance explained by the 2 components
```{r}
CorWithPC %>% apply(MARGIN=1,FUN=abs) %>% t() %>%
  apply(MARGIN=1,FUN=function(a) 100*cumsum(a)/sum(a))

```



\pagebreak

## c) Interpret the two principal components obtained in Part b. (Note that the first component is essentially a normalized unit vector and might measure the athletic excellence of a given nation. The second component might measure the relative strength of a nation at various running distances.)

It seems the first principal component is a meausure of how much less time the atheletes of a particular nation take to complete a race relative to their other fellow competitiors from other nations. We can notice that athletes generally concentrate a lot of efforts in running very fast so that they complete their races in the shortest times possible in the 100 metre races and the marathon.

Clearly, the second principal component tells us about the physical strength of an athlete in a given race. We see that for 100 meters, the values are very high because athletes are giving their all while for the marathan, the values are actually negative because the athletes are usually very tired and they try to minimize using a lot of energy as a tactic to run for the very long distance.

\pagebreak

## d) Rank the nations based on their score on the first principal component. Does this ranking correspond with your inituitive notion of athletic excellence for the various countries?
```{r}
# CorWithPC2 <- cor( t(scale((trackrcs)[,-1])),  res$rotation[,1:2] )
NewScore <- as.matrix(trackrcs[,-1])%*%as.matrix(res$rotation[,1])
NewScore = cbind.data.frame(countries = trackrcs[,1], NewScore = NewScore)
NewScore[,1][order(NewScore[,2], decreasing = TRUE)]

```
This ranking indeed corresponds with my inituitive notion of the athletic excellence for the various countries. The principal components are indeed capturing well the ranking of the countries.



\pagebreak


# Question 2: Factor analysis
```{r}
factanal(trackrcs[,-1], factors = 3, covmat = S) # varimax is the default
factanal(trackrcs[,-1], factors = 3, covmat = R)

psych::principal(cov2cor(S), nfactors=3, rotate="varimax")
psych::fa(cov2cor(S), nfactors=3, rotate="varimax")

```

